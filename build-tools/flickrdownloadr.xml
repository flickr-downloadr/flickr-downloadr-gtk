<project>
    <shortName>flickrdownloadr</shortName>
    <fullName>flickr downloadr</fullName>
    <version>0.0.1</version>
    <licenseFile>../LICENSE</licenseFile>
    <wrapLicenseFileText>0</wrapLicenseFileText>
    <enableSslSupport>1</enableSslSupport>
    <leftImage>../misc/images/icons/icon.png</leftImage>
    <logoImage>../misc/images/logo-Small-About.png</logoImage>
    <splashImage>../misc/images/logo.png</splashImage>
    <wmImage>../misc/images/icons/icon-48.png</wmImage>
    <componentList>
        <component>
            <name>core</name>
            <description>flickr downloadr</description>
            <canBeEdited>0</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <desktopShortcutList>
                <shortcut>
                    <comment>Batch download photos from flickr</comment>
                    <exec>${installdir}/flickrdownloadr</exec>
                    <icon>${installdir}/icon.png</icon>
                    <name>${product_fullname}-${product_version}</name>
                    <path>${installdir}/</path>
                    <platforms>all</platforms>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}\flickr-downloadr.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon>${installdir}\icon.ico</windowsIcon>
                    <windowsPath>${installdir}</windowsPath>
                </shortcut>
            </desktopShortcutList>
            <folderList>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfiles</name>
                    <platforms>all</platforms>
                    <shortcutList>
                        <shortcut>
                            <comment>Uninstall</comment>
                            <exec>${installdir}/${uninstallerName}</exec>
                            <icon></icon>
                            <name>Uninstall ${product_fullname}</name>
                            <path>${installdir}</path>
                            <platforms>all</platforms>
                            <runAsAdmin>0</runAsAdmin>
                            <runInTerminal>0</runInTerminal>
                            <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                            <windowsExecArgs></windowsExecArgs>
                            <windowsIcon></windowsIcon>
                            <windowsPath>${installdir}</windowsPath>
                        </shortcut>
                    </shortcutList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileslinux</name>
                    <platforms>linux</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>../source/bin/Release/linux-bundle/bin</origin>
                        </distributionDirectory>
                        <distributionFile>
                            <origin>../source/bin/Release/linux-bundle/flickrdownloadr</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../misc/images/icons/icon.png</origin>
                        </distributionFile>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileslinuxx64</name>
                    <platforms>linux-x64</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>../source/bin/Release/linux-bundle/bin</origin>
                        </distributionDirectory>
                        <distributionFile>
                            <origin>../source/bin/Release/linux-bundle/flickrdownloadr</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../misc/images/icons/icon.png</origin>
                        </distributionFile>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileswindows</name>
                    <platforms>windows</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>../source/bin/Release/flickr-downloadr.exe</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/Castle.Core.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/DotNetOpenAuth.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/FloydPink.Flickr.Downloadr.Bootstrap.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/FloydPink.Flickr.Downloadr.Logic.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/FloydPink.Flickr.Downloadr.Model.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/FloydPink.Flickr.Downloadr.OAuth.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/FloydPink.Flickr.Downloadr.Presentation.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/FloydPink.Flickr.Downloadr.Repository.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/log4net.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/ServiceStack.Text.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/StructureMap.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../source/bin/Release/flickrdownloadr.log4net</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../misc/images/icons/icon.png</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../misc/images/icons/icon.ico</origin>
                        </distributionFile>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfilesosx</name>
                    <platforms>osx</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>../source/bin/Release/flickr downloadr.app</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
            </folderList>
            <startMenuShortcutList>
                <startMenuShortcut>
                    <comment>Uninstall ${product_fullname}</comment>
                    <name>Uninstall ${product_fullname}</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon></windowsIcon>
                    <windowsPath>${installdir}/</windowsPath>
                </startMenuShortcut>
                <startMenuShortcut>
                    <comment>${product_shortname}-${product_version}</comment>
                    <name>${product_shortname}-${product_version}</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}\flickr-downloadr.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon>${installdir}\icon.ico</windowsIcon>
                    <windowsPath>${installdir}</windowsPath>
                </startMenuShortcut>
            </startMenuShortcutList>
        </component>
        <component>
            <name>dotnet</name>
            <description>.NET Framework</description>
            <canBeEdited>0</canBeEdited>
            <detailedDescription>Microsoft .NET Framework 4.5</detailedDescription>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>.NET installer</description>
                    <destination>${installdir}</destination>
                    <name>dotnet</name>
                    <platforms>windows</platforms>
                    <ruleList>
                        <isTrue value="0"/>
                    </ruleList>
                </folder>
            </folderList>
            <readyToInstallActionList>
                <autodetectDotNetFramework>
                    <validDotNetVersionList>
                        <validDotNetVersion>
                            <frameworkType>full</frameworkType>
                            <maxVersion></maxVersion>
                            <minVersion>4.0</minVersion>
                        </validDotNetVersion>
                    </validDotNetVersionList>
                </autodetectDotNetFramework>
                <actionGroup>
                    <progressText>Installing .NET framework</progressText>
                    <actionList>
                        <httpGet>
                            <filename>${system_temp_directory}/dotnet45.exe</filename>
                            <progressText>Downloading .NET installer</progressText>
                            <url>https://flickrdownloadr.com/installer/windows/dependencies/dotnet45.exe</url>
                        </httpGet>
                        <runProgram>
                            <program>${system_temp_directory}/dotnetfx.exe</program>
                            <programArguments>/q:a "/c:install.exe /qb"</programArguments>
                            <progressText>Installing .NET framework</progressText>
                        </runProgram>
                        <deleteFile>
                            <path>${system_temp_directory}/dotnetfx.exe</path>
                        </deleteFile>
                    </actionList>
                    <ruleList>
                        <isFalse>
                            <value>${dotnet_autodetected}</value>
                        </isFalse>
                    </ruleList>
                </actionGroup>
            </readyToInstallActionList>
            <shouldPackRuleList>
                <isTrue>
                    <value>${pack_windows_platform_files}</value>
                </isTrue>
            </shouldPackRuleList>
        </component>
        <component>
            <name>gtksharp</name>
            <description>GTK# Framework</description>
            <canBeEdited>0</canBeEdited>
            <detailedDescription>GTK# is a Graphical User Interface Toolkit for Mono and .NET which is used to build the user interface for flickr downloadr</detailedDescription>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>GTK#</description>
                    <destination>${installdir}</destination>
                    <name>gtksharp</name>
                    <platforms>windows</platforms>
                </folder>
            </folderList>
            <readyToInstallActionList>
                <actionGroup>
                    <progressText>Installing GTK# Framework</progressText>
                    <actionList>
                        <showProgressDialog>
                            <progressText>Downloading And Installing GTK# Framework</progressText>
                            <title>Installing GTK# Framework</title>
                            <actionList>
                                <httpGet>
                                    <filename>${system_temp_directory}/gtk-sharp.msi</filename>
                                    <progressText>Downloading GTK# Installer</progressText>
                                    <url>https://download.xamarin.com/GTKforWindows/Windows/gtk-sharp-2.12.45.msi</url>
                                </httpGet>
                                <runProgram>
                                    <program>msiexec</program>
                                    <programArguments>/i "${system_temp_directory}\gtk-sharp.msi"</programArguments>
                                    <progressText>Installing GTK#</progressText>
                                </runProgram>
                            </actionList>
                            <ruleList>
                                <registryTest>
                                    <key>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v4.0.30319\AssemblyFoldersEx\GtkSharp</key>
                                    <logic>exists</logic>
                                    <name></name>
                                    <negate>1</negate>
                                </registryTest>
                            </ruleList>
                        </showProgressDialog>
                    </actionList>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                    </ruleList>
                </actionGroup>
            </readyToInstallActionList>
            <shouldPackRuleList>
                <isTrue>
                    <value>${pack_windows_platform_files}</value>
                </isTrue>
            </shouldPackRuleList>
        </component>
        <component>
            <name>monoinstaller</name>
            <description>Mono &amp; GTK# Installer</description>
            <canBeEdited>0</canBeEdited>
            <downloadable>1</downloadable>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>Mono Installer</description>
                    <destination>${installdir}</destination>
                    <name>monoinstaller</name>
                    <platforms>all</platforms>
                </folder>
                <folder>
                    <description>apt-get-install-script</description>
                    <destination>${installdir}/aptgetscript</destination>
                    <name>aptgetscript</name>
                    <platforms>all</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>apt-get-install.sh</origin>
                        </distributionFile>
                    </distributionFileList>
                </folder>
            </folderList>
            <readyToInstallActionList>
                <actionGroup>
                    <progressText>Installing Mono Framework</progressText>
                    <actionList>
                        <actionGroup>
                            <progressText>Installing Mono Framework for Mac</progressText>
                            <actionList>
                                <showProgressDialog>
                                    <title>Installing Mono Framework for Mac</title>
                                    <actionList>
                                        <httpGet>
                                            <filename>${system_temp_directory}/MonoFramework-MDK-6.6.0.166.macos10.xamarin.universal.pkg</filename>
                                            <progressText>Downloading Mono Framework Installer</progressText>
                                            <url>https://download.mono-project.com/archive/6.6.0/macos-10-universal/MonoFramework-MDK-6.6.0.166.macos10.xamarin.universal.pkg</url>
                                        </httpGet>
                                        <runProgram>
                                            <program>open</program>
                                            <programArguments>-W "${system_temp_directory}/MonoFramework-MDK-6.6.0.166.macos10.xamarin.universal.pkg"</programArguments>
                                            <progressText>Installing Mono Framework</progressText>
                                        </runProgram>
                                    </actionList>
                                    <ruleList>
                                        <fileExists>
                                            <negate>1</negate>
                                            <path>/Library/Frameworks/Mono.framework</path>
                                        </fileExists>
                                    </ruleList>
                                </showProgressDialog>
                            </actionList>
                            <ruleList>
                                <platformTest>
                                    <type>osx</type>
                                </platformTest>
                            </ruleList>
                        </actionGroup>
                        <actionGroup>
                            <progressText>Installing Mono Framework...</progressText>
                            <actionList>
                                <showProgressDialog>
                                    <title>Installing Mono Framework</title>
                                    <actionList>
                                        <setInstallerVariable>
                                            <name>packages_to_install</name>
                                            <value></value>
                                        </setInstallerVariable>
                                        <runProgram>
                                            <abortOnError>0</abortOnError>
                                            <program>dpkg</program>
                                            <programArguments>-s mono-complete</programArguments>
                                            <showMessageOnError>0</showMessageOnError>
                                            <ruleList>
                                                <programTest condition="is_in_path" name="dpkg"/>
                                            </ruleList>
                                        </runProgram>
                                        <if>
                                            <actionList>
                                                <setInstallerVariable name="mono_installed" value="0"/>
                                            </actionList>
                                            <conditionRuleList>
                                                <compareValues logic="equals" value1="1" value2="${program_exit_code}"/>
                                            </conditionRuleList>
                                            <elseActionList>
                                                <setInstallerVariable name="mono_installed" value="1"/>
                                            </elseActionList>
                                            <ruleList>
                                                <programTest condition="is_in_path" name="dpkg"/>
                                            </ruleList>
                                        </if>
                                        <setInstallerVariable>
                                            <name>packages_to_install</name>
                                            <value>${packages_to_install} mono-complete</value>
                                            <ruleList>
                                                <isFalse>
                                                    <value>${mono_installed}</value>
                                                </isFalse>
                                            </ruleList>
                                        </setInstallerVariable>
                                        <runProgram>
                                            <abortOnError>0</abortOnError>
                                            <program>dpkg</program>
                                            <programArguments>-s gtk-sharp3</programArguments>
                                            <showMessageOnError>0</showMessageOnError>
                                            <ruleList>
                                                <programTest condition="is_in_path" name="dpkg"/>
                                            </ruleList>
                                        </runProgram>
                                        <if>
                                            <actionList>
                                                <runProgram>
                                                    <abortOnError>0</abortOnError>
                                                    <program>dpkg</program>
                                                    <programArguments>-s gtk-sharp2</programArguments>
                                                    <showMessageOnError>0</showMessageOnError>
                                                    <ruleList>
                                                        <programTest condition="is_in_path" name="dpkg"/>
                                                    </ruleList>
                                                </runProgram>
                                                <if>
                                                    <actionList>
                                                        <setInstallerVariable name="gtk_sharp_installed" value="0"/>
                                                    </actionList>
                                                    <conditionRuleList>
                                                        <compareValues logic="equals" value1="1" value2="${program_exit_code}"/>
                                                    </conditionRuleList>
                                                    <elseActionList>
                                                        <setInstallerVariable name="gtk_sharp_installed" value="1"/>
                                                    </elseActionList>
                                                    <ruleList>
                                                        <programTest condition="is_in_path" name="dpkg"/>
                                                    </ruleList>
                                                </if>
                                            </actionList>
                                            <conditionRuleList>
                                                <compareValues logic="equals" value1="1" value2="${program_exit_code}"/>
                                            </conditionRuleList>
                                            <elseActionList>
                                                <setInstallerVariable name="gtk_sharp_installed" value="1"/>
                                            </elseActionList>
                                            <ruleList>
                                                <programTest condition="is_in_path" name="dpkg"/>
                                            </ruleList>
                                        </if>
                                        <setInstallerVariable>
                                            <name>packages_to_install</name>
                                            <value>${packages_to_install} gtk-sharp2</value>
                                            <ruleList>
                                                <isFalse>
                                                    <value>${gtk_sharp_installed}</value>
                                                </isFalse>
                                            </ruleList>
                                        </setInstallerVariable>
                                        <actionGroup>
                                            <actionList>
                                                <createTimeStamp>
                                                    <format>%Y%m%d%H%M%S</format>
                                                    <variable>timestamp</variable>
                                                </createTimeStamp>
                                                <setInstallerVariable>
                                                    <name>tempDir</name>
                                                    <value>/tmp/.tempDir${timestamp}</value>
                                                </setInstallerVariable>
                                                <createDirectory>
                                                    <path>${tempDir}</path>
                                                </createDirectory>
                                                <unpackFile>
                                                    <component>monoinstaller</component>
                                                    <destination>${tempDir}/apt-get-install.sh</destination>
                                                    <folder>aptgetscript</folder>
                                                    <origin>apt-get-install.sh</origin>
                                                </unpackFile>
                                                <runProgram>
                                                    <explanation>Installing packages '${packages_to_install}'</explanation>
                                                    <program>gksu</program>
                                                    <programArguments>--preserve-env --sudo-mode --description "flickr downloadr Installer" "${tempDir}/apt-get-install.sh '${packages_to_install}'"</programArguments>
                                                    <progressText>Installing dependencies...</progressText>
                                                    <ruleList>
                                                        <programTest>
                                                            <condition>is_in_path</condition>
                                                            <name>gksu</name>
                                                        </programTest>
                                                        <programTest>
                                                            <condition>is_in_path</condition>
                                                            <name>apt-get</name>
                                                        </programTest>
                                                    </ruleList>
                                                </runProgram>
                                                <showWarning>
                                                    <text>Cannot launch gksu. Install gksu (sudo apt-get install gksu) and rerun the installer. Or install these packages manually - ${packages_to_install}</text>
                                                    <title>${msg(MessageDialog.Warning)} - 'gksu' not found</title>
                                                    <ruleList>
                                                        <programTest>
                                                            <condition>is_in_path</condition>
                                                            <name>gksu</name>
                                                            <negate>1</negate>
                                                        </programTest>
                                                    </ruleList>
                                                </showWarning>
                                            </actionList>
                                            <ruleList>
                                                <stringTest>
                                                    <text>${packages_to_install}</text>
                                                    <type>not_empty</type>
                                                </stringTest>
                                            </ruleList>
                                        </actionGroup>
                                    </actionList>
                                </showProgressDialog>
                            </actionList>
                            <ruleList>
                                <ruleGroup>
                                    <ruleEvaluationLogic>or</ruleEvaluationLogic>
                                    <ruleList>
                                        <platformTest>
                                            <type>linux</type>
                                        </platformTest>
                                        <platformTest>
                                            <type>linux-x64</type>
                                        </platformTest>
                                    </ruleList>
                                </ruleGroup>
                            </ruleList>
                        </actionGroup>
                    </actionList>
                    <ruleList>
                        <platformTest>
                            <negate>1</negate>
                            <type>windows</type>
                        </platformTest>
                    </ruleList>
                </actionGroup>
            </readyToInstallActionList>
            <shouldPackRuleList>
                <isTrue>
                    <negate>1</negate>
                    <value>${pack_windows_platform_files}</value>
                </isTrue>
            </shouldPackRuleList>
        </component>
    </componentList>
    <preBuildActionList>
        <actionGroup>
            <explanation>Sign the Windows exe</explanation>
            <actionList>
                <setInstallerVariable>
                    <name>signtool</name>
                    <value>C:\Program Files (x86)\Windows Kits\8.1\bin\x64\signtool.exe</value>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>signtool</name>
                    <value>C:\Program Files (x86)\Microsoft SDKs\Windows\v7.1A\Bin\signtool.exe</value>
                    <ruleList>
                        <compareText>
                            <logic>equals</logic>
                            <text>${env(APPVEYOR)}</text>
                            <value>True</value>
                        </compareText>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>signing-certificate-file</name>
                    <value>${build_project_directory}/7a2a2296acceb2a76f89d69e827c4fe6.pfx</value>
                </setInstallerVariable>
                <runProgram>
                    <program>${signtool}</program>
                    <programArguments>sign /d "${project.fullName}" /t http://timestamp.verisign.com/scripts/timstamp.dll /f ${signing-certificate-file} /p ${env(FD_CERT_PWD)} "${build_project_directory}/../source/bin/Release/flickr-downloadr.exe"</programArguments>
                    <ruleList>
                        <isTrue>
                            <value>${runSignTool}</value>
                        </isTrue>
                    </ruleList>
                </runProgram>
            </actionList>
            <ruleList>
                <isTrue>
                    <value>${pack_windows_platform_files}</value>
                </isTrue>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </actionGroup>
    </preBuildActionList>
    <postBuildActionList>
        <actionGroup>
            <explanation>Signing the Windows Installer</explanation>
            <actionList>
                <runProgram>
                    <program>${signtool}</program>
                    <programArguments>sign /d "${project.fullName}" /t http://timestamp.verisign.com/scripts/timstamp.dll /f ${signing-certificate-file} /p ${env(FD_CERT_PWD)} "${installbuilder_output_directory}/${project.installerFilename}"</programArguments>
                    <ruleList>
                        <isTrue>
                            <value>${runSignTool}</value>
                        </isTrue>
                    </ruleList>
                </runProgram>
            </actionList>
            <ruleList>
                <isTrue>
                    <value>${pack_windows_platform_files}</value>
                </isTrue>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </actionGroup>
    </postBuildActionList>
    <initializationActionList>
        <setInstallerVariable>
            <name>pack_windows_platform_files</name>
            <value>false</value>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>pack_osx_platform_files</name>
            <value>false</value>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>pack_linux_platform_files</name>
            <value>false</value>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>pack_linux-x64_platform_files</name>
            <value>false</value>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>runSignTool</name>
            <value>false</value>
        </setInstallerVariable>
    </initializationActionList>
    <preInstallationActionList>
        <setInstallerVariable>
            <name>flickr-downloadr-installation</name>
            <value>${env(HOME)}/.flickr-downloadr</value>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>flickr-downloadr-installation-properties</name>
            <value>${flickr-downloadr-installation}/installation.properties</value>
        </setInstallerVariable>
        <actionGroup>
            <explanation>Handle Existing Installation</explanation>
            <progressText>Checking for existing installations</progressText>
            <actionList>
                <propertiesFileGet>
                    <file>${flickr-downloadr-installation-properties}</file>
                    <key>version</key>
                    <variable>fd-previous-version</variable>
                </propertiesFileGet>
                <propertiesFileGet>
                    <file>${flickr-downloadr-installation-properties}</file>
                    <key>install-directory</key>
                    <variable>fd-previous-installdir</variable>
                </propertiesFileGet>
                <setInstallerVariable>
                    <name>fd-previous-uninstaller</name>
                    <value>${fd-previous-installdir}/${uninstallerName}</value>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>fd-previous-uninstaller</name>
                    <value>${fd-previous-uninstaller}.app/Contents/MacOS/installbuilder.sh</value>
                    <ruleList>
                        <platformTest>
                            <type>osx</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>fd-previous-uninstaller</name>
                    <value>${fd-previous-uninstaller}.exe</value>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <if>
                    <progressText>Checking Existing Installation</progressText>
                    <actionList>
                        <showInfo>
                            <text>Uninstalling previous version (${fd-previous-version}) before installing the latest - ${product_version}.</text>
                            <title>Uninstallation Required</title>
                        </showInfo>
                        <showProgressDialog>
                            <title>Uninstalling v${fd-previous-version}</title>
                            <actionList>
                                <runProgram>
                                    <program>${fd-previous-uninstaller}</program>
                                    <programArguments></programArguments>
                                    <progressText>Uninstalling v${fd-previous-version}</progressText>
                                </runProgram>
                            </actionList>
                        </showProgressDialog>
                    </actionList>
                    <conditionRuleList>
                        <compareVersions>
                            <logic>greater</logic>
                            <version1>${product_version}</version1>
                            <version2>${fd-previous-version}</version2>
                        </compareVersions>
                    </conditionRuleList>
                    <elseActionList>
                        <showWarning>
                            <text>The currently installed version is the same or newer than the current. Exiting the installer...</text>
                            <title>Current/Newer Installation Exists</title>
                        </showWarning>
                        <exit>
                            <progressText>Exiting Installer</progressText>
                        </exit>
                    </elseActionList>
                </if>
            </actionList>
            <ruleList>
                <fileExists>
                    <path>${flickr-downloadr-installation-properties}</path>
                </fileExists>
            </ruleList>
        </actionGroup>
    </preInstallationActionList>
    <postInstallationActionList>
        <deleteFile>
            <path>${installdir}/aptgetscript</path>
        </deleteFile>
        <createDirectory>
            <path>${flickr-downloadr-installation}</path>
            <ruleList>
                <fileExists>
                    <negate>1</negate>
                    <path>${flickr-downloadr-installation}</path>
                </fileExists>
            </ruleList>
        </createDirectory>
        <propertiesFileSet>
            <file>${flickr-downloadr-installation-properties}</file>
            <key>version</key>
            <value>${product_version}</value>
        </propertiesFileSet>
        <propertiesFileSet>
            <file>${flickr-downloadr-installation-properties}</file>
            <key>install-directory</key>
            <value>${installdir}</value>
        </propertiesFileSet>
    </postInstallationActionList>
    <preUninstallationActionList>
        <setInstallerVariable>
            <name>flickr-downloadr-installation</name>
            <value>${env(HOME)}/.flickr-downloadr</value>
        </setInstallerVariable>
    </preUninstallationActionList>
    <postUninstallationActionList>
        <deleteFile>
            <path>${flickr-downloadr-installation}</path>
        </deleteFile>
    </postUninstallationActionList>
    <createOsxBundleDmg>1</createOsxBundleDmg>
    <debianCustomPackageDirectory>debian</debianCustomPackageDirectory>
    <description>Batch download photos from flickr</description>
    <enableRollback>0</enableRollback>
    <enableTimestamp>1</enableTimestamp>
    <height>480</height>
    <osxApplicationBundleIcon>../misc/images/icons/flickr-downloadr-new.icns</osxApplicationBundleIcon>
    <osxApplicationBundleIdentifier>com.floydpink.mac.flickrdownloadr</osxApplicationBundleIdentifier>
    <osxDmgBackgroundImage>../misc/images/icons/dmg-background.png</osxDmgBackgroundImage>
    <osxSigningIdentity>Developer ID Application: Haridas Pachuveetil (X47E7X2X6J)</osxSigningIdentity>
    <osxSigningPkcs12File>X47E7X2X6J-code-signing-certificate.p12</osxSigningPkcs12File>
    <osxSigningPkcs12Password>${env(FD_CERT_PWD)}</osxSigningPkcs12Password>
    <osxUninstallerApplicationBundleIcon>../misc/images/icons/flickr-downloadr-new.icns</osxUninstallerApplicationBundleIcon>
    <outputDirectory>../dist/${platform_name}</outputDirectory>
    <productComments>Batch download photos from flickr</productComments>
    <productContact>contact.us@flickrdownloadr.com</productContact>
    <productDisplayIcon>${installdir}\icon.ico</productDisplayIcon>
    <productUrlHelpLink>https://github.com/flickr-downloadr/flickr-downloadr/issues</productUrlHelpLink>
    <productUrlInfoAbout>https://flickrdownloadr.com</productUrlInfoAbout>
    <registerWithPackageDatabase>1</registerWithPackageDatabase>
    <saveRelativePaths>1</saveRelativePaths>
    <summary>A cross-platform desktop app, written in Mono that would download (all or selected) photos from your photostream in their selected size along with their description, title and tags.</summary>
    <vendor>flickrdownloadr.com</vendor>
    <width>640</width>
    <windowsExecutableIcon>../misc/images/icons/installericon.ico</windowsExecutableIcon>
    <windowsUninstallerExecutableIcon>../misc/images/icons/installericon.ico</windowsUninstallerExecutableIcon>
    <parameterList>
        <directoryParameter>
            <name>installdir</name>
            <description>Installer.Parameter.installdir.description</description>
            <explanation>Installer.Parameter.installdir.explanation</explanation>
            <value></value>
            <default>${platform_install_prefix}/${product_shortname}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>1</mustBeWritable>
            <mustExist>0</mustExist>
            <width>40</width>
        </directoryParameter>
        <stringParameter name="dmg_icon_position" value="320, 280" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
            <allowEmptyValue>1</allowEmptyValue>
            <width>40</width>
        </stringParameter>
        <stringParameter name="dmg_window_bounds" value="300, 200, 940, 680" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
            <allowEmptyValue>1</allowEmptyValue>
            <width>40</width>
        </stringParameter>
        <stringParameter name="dmg_icon_size" value="128" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
            <allowEmptyValue>1</allowEmptyValue>
            <width>40</width>
        </stringParameter>
    </parameterList>
    <platformOptionsList>
        <platformOptions>
            <installerFilename>Install flickr downloadr (v${product_version}).app</installerFilename>
            <platform>osx</platform>
        </platformOptions>
    </platformOptionsList>
</project>

